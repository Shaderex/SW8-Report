%!TEX root = ../../super_main.tex

\section{Client Application}
\label{sec:client_application}

In relation to the architecture illustrated in \figrefpage{fig:system_architecture}, the client application is the part of the system that should run on the smartphone device of a participant. This component is responsible for interacting with the participant, e.g. gathering labels or joining campaigns; gathering data from the sensors on the device; and communicating with wearables in order to get data from them. The sensors of the smartphone are available directly from the device, and the underlying hardware. In contrast to this,sensors from other ubiquitous devices are typically available through some application on the device, referred to as ``Wearable Application'' in the architecture. It is common to have one application per brand of wearable, which in our case is the Microsoft Health application used to communicate with the Microsoft Band 2 smart band, that we use in our system.
\\\\
The client application contains a service component that is the main component of the client application. This service runs independently in the background at all times, and is the part of client application that communicates with the different sensor providers, and also uploads the collected snapshots to the server. Furthermore it is also responsible for prompting the participants to answer the questionnaires. This service is completely detached from the graphical interface, and it runs in its own separate process, because it needs to be responsive to changes read by sensors, and should not be influence the graphical. This separation is furthermore beneficial, because it allows the Android OS to properly close and free the GUI components when they are not used and deallocate all memory used by them. 
\\\\
The GUI components consists of two parts, a settings interface and a questionnaire interface. The settings interface allows for the participant to browse details and join campaigns. Furthermore, it also has some communication with the web server, where it fetches the specifications of campaigns, and reports back to the server which campaigns the participants has joined. The questionnaire interface is a series of user inputs, where the participants can provide answers for the questions of a questionnaire. This interface is prompted to the user by using notifications, which are sent by the service for every snapshot, in order to obtain labels on the data if possible.
\\\\
The service component is in need of some persistent storage on the device, to ensure that it can store gathered snapshots, so that it can upload the data using best practices in regards of power consumption and robustness as described in \secref{sec:general_strategies}. For this reason the application has a storage module where we utilize a library called Realm, which is further described in \secref{sub:local_storage}.
\\\\
Lastly the service component is heavily dependent on multiple instances of an abstraction called sensor provider. These instances are used to abstract various types of sensors, for example hardware sensors on the device, software sensors, and sensors from external wearables. The service only needs to manage the specifications of campaigns, and request the data from the sensor providers accordingly, before it stores the data that has been gathered from the providers on the device. The service assumes, that the providers guarantee, that the amount of data requested is also returned, and that they keep their deadlines in regards to timing of sensor readings.

% From the service point of view, it only needs to manage the specification of campaigns and request the data from these providers accordingly before it stores the data that has been gathered from these providers on the device. The controller of the service assumes that the interface of these providers guarantees the amount of data requested and that they keep their deadlines in regards to timing of sensor readings.

\input{content/architecture/client_server_communication/client_request}
